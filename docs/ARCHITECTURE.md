# Plast Mem Architecture Overview

## Project Structure

Plast Mem is an experimental llm memory layer for cyber waifu. The codebase is a Cargo workspace with separate crates for each layer.

## Crates

### 1. plastmem

Entry program. Initializes tracing, database connection, migrations, job storage, and spawns the worker and server tasks.

**Key Components**:
- `main.rs`: Application bootstrap

### 2. plastmem_core

Core domain logic

**Key Components**:
- `memory/`: Various types of memory
  - `episodic.rs`: Episodic Memory (hybrid retrieval with FSRS re-ranking)
  - `creation.rs`: Episode generation (LLM) and creation (FSRS init, persistence)
- `message_queue/`: Message queue and segmentation
  - `mod.rs`: MessageQueue struct and core queue operations
  - `segmentation.rs`: Rule-based segmentation triggers
  - `boundary.rs`: Dual-channel boundary detection (topic shift + surprise)
  - `pending_reviews.rs`: Pending review tracking
  - `state.rs`: Event model and embedding state management

### 3. plastmem_migration

Database table migrations

**Key Components**:
- `m**.rs`: Migration files

### 4. plastmem_entities

Database table entities, generated by `sea-orm-cli`

**Key Components**:
- `episodic_memory.rs`: Episodic Memory entity
- `message_queue.rs`: Message Queue entity

### 5. plastmem_ai

Wrapped AI SDK

**Key Components**:
- `embed.rs`: Create embeddings
- `generate_text.rs`: Create chat completion
- `generate_object.rs`: Create structured output (JSON Schema)
- `lib.rs`: Re-exports AI primitives (embed, generate_text, generate_object, cosine_similarity)

### 6. plastmem_shared

Reusable utilities

**Key Components**:
- `env.rs`: Global app environment
- `error.rs`: Global app error

### 7. plastmem_worker

Background tasks worker

**Key Components**:
- `event_segmentation.rs`: Job scheduling shell â€” dispatches to core's boundary detection and episode creation
- `memory_review.rs`: LLM-based review of retrieved memories, updates FSRS parameters

### 8. plastmem_server

HTTP server and API handlers

**Key Components**:
- `api/`: Public HTTP API
  - `add_message.rs`: Message ingestion endpoint
  - `retrieve_memory.rs`: Memory retrieval endpoints (raw JSON and formatted)
- `utils/`: Server-specific utilities
  - `state.rs`: AppState (database + job storage)
  - `shutdown_signal.rs`: Graceful shutdown handling
- `server.rs`: Axum HTTP server setup

## Further Reading

- [Episodic Memory](architecture/episodic_memory.md) - Core memory type for conversation storage
- [Segmentation](architecture/segmentation.md) - Event boundary detection (rules + dual-channel LLM)
- [FSRS](architecture/fsrs.md) - Spaced repetition mechanics and retrievability
- [Memory Retrieval](architecture/retrieve_memory.md) - Hybrid search API (BM25 + vector + FSFS rerank)
- [Memory Review](architecture/memory_review.md) - LLM-based relevance review and FSRS updates
